(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{182:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"node-exporter简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-exporter简介"}},[s._v("#")]),s._v(" node exporter简介")]),s._v(" "),t("p",[s._v("prometheus主要负责数据的收集、查询和存储。例如Linux主机的cpu使用率，内存使用率等数据，需要使用node exporter这个工具。prometheus周期性收集node exporter的数据。")]),s._v(" "),t("h2",{attrs:{id:"node-exporter部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-exporter部署"}},[s._v("#")]),s._v(" node exporter部署")]),s._v(" "),t("p",[s._v("下载node exporter工具，并解压")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/\nhttps://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzf node_exporter-0.18.1.linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" node_exporter\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("这里我们使用supervisor作为进程管理工具，可以方便管理进程得到启动、停止和重启。")]),s._v(" "),t("p",[s._v("输出默认的supervisor的配置文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" etc\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" etc\necho_supervisord_conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" supervisord.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("添加node exporter配置信息")]),s._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[program:node_exporter]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 启动进程的命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("command")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("/usr/local/node_exporter/node_exporter")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 进程的名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("process_name")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("node_exporter")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 进程数量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("numprocs")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("1             ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 工作目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("directory")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("/usr/local/node_exporter/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";自动启动")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("autostart")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("true     ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 运行用户        ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("root               ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("启动supervisor服务")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("supervisord -c etc/supervisord.con\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查看端口，"),t("code",[s._v(":9100")]),s._v("端口已经监听了")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tnlp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" node_exporter\ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::9100                 :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("94865")]),s._v("/node_exporter\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("用curl命令访问，可以看到监控的数据")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://127.0.0.1:9100\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://img.array.fun/img/2020/02/24/e4qt0ozbgmjb8aw.webp",alt:"测试访问"}})]),s._v(" "),t("h2",{attrs:{id:"配置prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置prometheus"}},[s._v("#")]),s._v(" 配置Prometheus")]),s._v(" "),t("p",[s._v("在Prometheus配置文件加上")]),s._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A scrape configuration containing exactly one endpoint to scrape:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Here it's Prometheus itself.")]),s._v("\nscrape_configs:\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n  - job_name: 'prometheus'\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("    # metrics_path defaults to '/metrics'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("    # scheme defaults to 'http'.")]),s._v("\n\n    static_configs:\n            - targets: ['192.168.3.3:9090']\n\n  - job_name: 'linux'\n    static_configs:\n            - targets: ['192.168.3.3:9100']\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("这样,Prometheus就能pull到 Linux主机监控数据了。")]),s._v(" "),t("h2",{attrs:{id:"influxdb查看查询数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#influxdb查看查询数据"}},[s._v("#")]),s._v(" InfluxDB查看查询数据")]),s._v(" "),t("p",[s._v("Prometheus也会把采集到的数据存储到InfluxDB中。可以到influxDB中查看采集到数据")]),s._v(" "),t("p",[t("strong",[s._v("使用InfluxQL查询数据，最好指定查询数据的条数")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img.array.fun/img/2020/02/24/9dq1k6226dt5y2q.webp",alt:"存储数据"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);