(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{190:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"判断服务端是否开启认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#判断服务端是否开启认证"}},[s._v("#")]),s._v(" 判断服务端是否开启认证")]),s._v(" "),t("p",[s._v("输入命令"),t("code",[s._v("mongo")]),s._v("，如果服务端开启认证，就会显示为")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img.array.fun/img/2020/02/19/x07snco3iso3k1n.webp",alt:"开启认证"}})]),s._v(" "),t("p",[s._v("服务端没有开启认证，就会有一个WARNING")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img.array.fun/img/2020/02/19/u35bdnayd7yu6dr.webp",alt:"没有开启认证"}})]),s._v(" "),t("h2",{attrs:{id:"新建一个全局管理员"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新建一个全局管理员"}},[s._v("#")]),s._v(" 新建一个全局管理员")]),s._v(" "),t("p",[s._v("新建一个mongodb全局管理员，用于管理所有数据库中的用户和角色")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("db.createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   user:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(",\n   pwd:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v(",\n   roles:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userAdminAnyDatabase"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("其中用户名是root，密码是123456，角色是userAdminAnyDatabase。")]),s._v(" "),t("p",[s._v("如果创建成功，就会返回")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Successfully added user: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"roles"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userAdminAnyDatabase"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"开启mongodb认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启mongodb认证"}},[s._v("#")]),s._v(" 开启mongodb认证")]),s._v(" "),t("p",[s._v("默认情况下，没有启用mongodb的认证功能，是以匿名的方式登陆mongodb服务器。")]),s._v(" "),t("p",[s._v("先删除当前的docker容器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker container stop mongodb\ndocker container "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" mongodb\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("然后启用具有认证功能的mongodb容器。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker run --name mongo -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v(":27017 -v /data/mongodb/:/data/db -v /etc/localtime:/etc/localtime -d mongo mongod --auth\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("登陆mongod服务器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mongo\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输入用户名和密码")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("db.auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果登陆成功，就会返回")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"读写数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#读写数据库"}},[s._v("#")]),s._v(" 读写数据库")]),s._v(" "),t("p",[s._v("不过当前用户是没有读写数据的权限的，想要读写指定数据库中的集合数据，需要新建一个用户")]),s._v(" "),t("p",[s._v("切换数据库，比如test")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("use "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("新建用户")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('db.createUser({\n   user:"admin",\n   pwd:"123456",\n   roles:["readWrite"]})\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("这样这个用户就能读取指定数据库test的集合数据了")]),s._v(" "),t("h2",{attrs:{id:"权限和角色表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#权限和角色表"}},[s._v("#")]),s._v(" 权限和角色表")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("角色")]),s._v(" "),t("th",[s._v("备注")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("read")]),s._v(" "),t("td",[s._v("允许用户读指定数据库")])]),s._v(" "),t("tr",[t("td",[s._v("readWrite")]),s._v(" "),t("td",[s._v("允许用户读写指定数据库")])]),s._v(" "),t("tr",[t("td",[s._v("dbAdmin")]),s._v(" "),t("td",[s._v("允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计")])]),s._v(" "),t("tr",[t("td",[s._v("userAdmin")]),s._v(" "),t("td",[s._v("可以在指定数据库里创建、删除和管理用户")])])])]),s._v(" "),t("h2",{attrs:{id:"自定义权限的角色"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义权限的角色"}},[s._v("#")]),s._v(" 自定义权限的角色")]),s._v(" "),t("p",[s._v("mongodb默认角色和权限管理，不是非常自由。不过可以自定义角色和权限管理。")]),s._v(" "),t("p",[s._v("创建只能读取test.accounts集合和web.log集合的用户")]),s._v(" "),t("ul",[t("li",[s._v("创建自定义角色")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("db.createRole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   role:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"readTestAccounts"')]),s._v(",\n   privileges:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     resource:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("db:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(",collection:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),s._v(", action:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"find"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("，\n     resource:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("db:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v(",collection:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"accounts"')]),s._v(", action:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"find"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n     roles:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("创建用户")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("db.createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   user:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"readtest"')]),s._v(",\n   pwd:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v(",\n   roles:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"readTestAccounts"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"查看创建的用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看创建的用户"}},[s._v("#")]),s._v(" 查看创建的用户")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("use admin\nshow "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v("\ndb.system.users.find"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndb.runCommand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("usersInfo:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"修改用户密码和删除用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改用户密码和删除用户"}},[s._v("#")]),s._v(" 修改用户密码和删除用户")]),s._v(" "),t("ul",[t("li",[s._v("修改用户密码")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("use admin\ndb.changeUserPassword"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pwd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("删除用户")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("use admin\ndb.dropUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);