---
title: 用Golang和mongodb交互之连接mongodb数据库
date: 2020-02-26
sidebar: 'auto'
categories:
- linux
tags:
- mongodb
publish: true
---

## 新建登陆账户

+ 登陆mongodb服务器，新建用户，授权其可以读写test数据库中的所有集合

```bash
db.createUser({
   user:"test",
   pwd:"123456",
   roles:["readWrite"]})
```

+ 启用mongodb登陆认证

```bash
docker run --name mongo -p 27017:27017 -v /data/mongodb/:/data/db -v /etc/localtime:/etc/localtime -d mongo mongod --auth
```

## 用Go登陆mongodb服务器

```go
credential := options.Credential{
	Username: "test",
	Password: "123456",
  AuthSource:"test",
}
clientOpts := options.Client().ApplyURI("mongodb://127.0.0.1:27017").SetAuth(credential)
if err := client.Ping(context.TODO(),readpref.Primary()); err != nil {
		panic(err)
	}
```

其中:

|字段|含义|
|---|----|
|Username|用户名|
|Password|密码|
|AuthSource|授权数据库|

如果登陆失败，会爆出panice，程序异常退出

```go
panic: connection() : auth error: sasl conversation error: unable to authenticate using mechanism "SCRAM-SHA-256": (AuthenticationFailed) Authentication failed.
```
